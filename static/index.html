<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <title>scrapesome - web scraping tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  <!-- Add this before your </body> tag -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="icon" href="https://raw.githubusercontent.com/scrapesome/scrapesome/refs/heads/main/docs/assets/images/favicon.png"/>
</head>
<body class="flex bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

  <!-- Sidebar -->
  <aside class="w-64 h-screen bg-white dark:bg-gray-800 shadow-md fixed flex flex-col">
    <div class="p-6 text-xl font-bold border-b dark:border-gray-700"><img src="https://raw.githubusercontent.com/scrapesome/scrapesome/refs/heads/main/docs/assets/images/favicon.png" width="150" height="150"/>
      <h1 class="text-3xl font-bold mb-6">scrapesome</h1></div>
    
    <nav class="flex-1 p-4 space-y-2">
      <button onclick="showPage('scraperPage')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">üß∞ Scraper</button>
      <button onclick="showPage('aboutPage')" class="w-full text-left px-3 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">‚ÑπÔ∏è About</button>
    </nav>

    <div class="p-4 border-t dark:border-gray-700 text-sm space-y-1">
      <a href="https://github.com/scrapesome/scrapesome" target="_blank" class="block hover:underline">GitHub</a>
      <a href="https://pypi.org/project/scrapesome/" target="_blank" class="block hover:underline">PyPI</a>
      <a href="http://scrapesome.github.io/scrapesome/" target="_blank" class="block hover:underline">Docs</a>
    </div>

    <div class="p-4">
      <button onclick="toggleDarkMode()" class="w-full px-3 py-2 border rounded text-sm dark:border-gray-600">üåì Toggle Dark Mode</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="ml-64 p-8 w-full max-w-5xl">
    
    <!-- Scraper Page -->
    <section id="scraperPage">
      <!-- <img src="https://raw.githubusercontent.com/scrapesome/scrapesome/refs/heads/main/docs/assets/images/favicon.png" width="150" height="150"/>
      <h1 class="text-3xl font-bold mb-6">scrapesome</h1> -->
      <form id="scrapeForm" class="space-y-4">
        <div>
          <label for="url" class="block font-semibold">URL *</label>
          <input id="url" name="url" type="url" required class="w-full px-4 py-2 border dark:bg-gray-700 dark:border-gray-600 rounded" placeholder="https://example.com">
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="outputFormat" class="block font-semibold">Output Format</label>
            <select id="outputFormat" class="w-full px-3 py-2 border dark:bg-gray-700 dark:border-gray-600 rounded">
              <option value="html">HTML</option>
              <option value="json">JSON</option>
              <option value="text">Text</option>
              <option value="markdown">Markdown</option>
            </select>
          </div>

          <div>
            <label for="timeout" class="block font-semibold">Timeout (sec)</label>
            <input id="timeout" type="range" min="1" max="30" value="10" class="w-full">
            <div id="timeoutValue" class="text-sm text-right">10s</div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="forcePlaywright" class="block font-semibold">Force Playwright</label>
            <select id="forcePlaywright" class="w-full px-3 py-2 border dark:bg-gray-700 dark:border-gray-600 rounded">
              <option value="false">False</option>
              <option value="true">True</option>
            </select>
          </div>

          <div>
            <label for="allowRedirects" class="block font-semibold">Allow Redirects</label>
            <select id="allowRedirects" class="w-full px-3 py-2 border dark:bg-gray-700 dark:border-gray-600 rounded">
              <option value="true">True</option>
              <option value="false">False</option>
            </select>
          </div>
        </div>

        <div>
          <label for="headers" class="block font-semibold">Headers (JSON format)</label>
          <textarea id="headers" rows="3" placeholder='{"User-Agent": "Mozilla/5.0"}' class="w-full px-4 py-2 border dark:bg-gray-700 dark:border-gray-600 rounded"></textarea>
        </div>

        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold">
          Scrape Now
        </button>
      </form>

      <div id="result" class="mt-6 hidden border-t pt-4 dark:border-gray-600">
        <h2 class="text-lg font-semibold">Result</h2>
        <pre id="output" class="whitespace-pre-wrap bg-gray-100 dark:bg-gray-700 p-3 rounded mt-2 max-h-64 overflow-auto"></pre>
      </div>
    </section>

    <!-- About Page -->
    <section id="aboutPage" class="hidden">
      <h1 class="text-3xl font-bold mb-4">About</h1>
      <p class="mb-2">This is a modern web scraper interface powered by a FastAPI backend.</p>
      <p class="mb-2">Use this tool to scrape websites using standard HTTP requests or Playwright-powered headless browsing.</p>
      <p>Customize the headers, timeout, and format as needed.</p>
    </section>

  </main>

  <script>
    // Timeout range update
const timeoutRange = document.getElementById("timeout");
const timeoutValue = document.getElementById("timeoutValue");
timeoutRange.addEventListener("input", () => {
  timeoutValue.textContent = `${timeoutRange.value}s`;
});

// Page switching
function showPage(pageId) {
  document.getElementById("scraperPage").classList.add("hidden");
  document.getElementById("aboutPage").classList.add("hidden");
  document.getElementById(pageId).classList.remove("hidden");
}

// Dark mode toggle
function toggleDarkMode() {
  document.documentElement.classList.toggle('dark');
}

// Form submit
document.getElementById("scrapeForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const getNullableValue = (value) => value.trim() === "" ? null : value;

  const url = getNullableValue(document.getElementById("url").value);
  const output_format_type = getNullableValue(document.getElementById("outputFormat").value);
  const force_playwright = document.getElementById("forcePlaywright").value === "true";
  const allow_redirects = document.getElementById("allowRedirects").value === "true";

  const timeoutRaw = parseInt(document.getElementById("timeout").value);
  const timeout = timeoutRaw === 0 ? null : timeoutRaw;

  const headersText = document.getElementById("headers").value;
  let headers;
  try {
    headers = headersText.trim() === "" ? null : JSON.parse(headersText);
  } catch (e) {
    alert("Invalid JSON in headers.");
    return;
  }

  const payload = {
    url,
    output_format_type,
    timeout,
    force_playwright,
    allow_redirects,
    headers,
  };

  try {
    const response = await fetch("/api/scrape", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const result = await response.json();
    const data = result?.data ?? result;
    document.getElementById("result").classList.remove("hidden");
    document.getElementById("output").textContent = JSON.stringify(data, null, 2);
  } catch (err) {
    alert("Failed to scrape: " + err.message);
    console.error(err);
  }
});
  </script>


  <!-- <script>
  const timeoutRange = document.getElementById("timeout");
  const timeoutValue = document.getElementById("timeoutValue");
  timeoutRange.addEventListener("input", () => {
    timeoutValue.textContent = `${timeoutRange.value}s`;
  });

  function showPage(pageId) {
    document.getElementById("scraperPage").classList.add("hidden");
    document.getElementById("aboutPage").classList.add("hidden");
    document.getElementById(pageId).classList.remove("hidden");
  }

  function toggleDarkMode() {
    document.documentElement.classList.toggle('dark');
  }

  function getNullableValue(value) {
    return value.trim() === "" ? null : value;
  }

  function renderJsonAsTable(jsonData) {
    if (typeof jsonData !== "object" || jsonData === null) {
      return `<pre>${JSON.stringify(jsonData, null, 2)}</pre>`;
    }

    let rows = "";

    if (Array.isArray(jsonData)) {
      const keys = Object.keys(jsonData[0] || {});
      const headers = keys.map(key => `<th class="border px-2 py-1">${key}</th>`).join("");
      const body = jsonData.map(item =>
        `<tr>${keys.map(key => `<td class="border px-2 py-1">${item[key]}</td>`).join("")}</tr>`
      ).join("");
      rows = `<thead><tr>${headers}</tr></thead><tbody>${body}</tbody>`;
    } else {
      rows = Object.entries(jsonData).map(([key, value]) =>
        `<tr><td class="border px-2 py-1 font-semibold">${key}</td><td class="border px-2 py-1">${JSON.stringify(value)}</td></tr>`
      ).join("");
      rows = `<tbody>${rows}</tbody>`;
    }

    return `<table class="table-auto border-collapse border w-full text-sm dark:text-white dark:border-gray-600 mt-2">${rows}</table>`;
  }

  document.getElementById("scrapeForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const url = getNullableValue(document.getElementById("url").value);
    const output_format_type = getNullableValue(document.getElementById("outputFormat").value);
    const force_playwright = document.getElementById("forcePlaywright").value === "true";
    const allow_redirects = document.getElementById("allowRedirects").value === "true";

    const timeoutRaw = parseInt(document.getElementById("timeout").value);
    const timeout = timeoutRaw === 0 ? null : timeoutRaw;

    const headersText = document.getElementById("headers").value;
    let headers;
    try {
      headers = headersText.trim() === "" ? null : JSON.parse(headersText);
    } catch (e) {
      alert("Invalid JSON in headers.");
      return;
    }

    const payload = {
      url,
      output_format_type,
      timeout,
      force_playwright,
      allow_redirects,
      headers,
    };

    try {
      const response = await fetch("/api/scrape", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const result = await response.json();
      const data = result?.data ?? result;
      const format = output_format_type || "html";

      const outputContainer = document.getElementById("output");
      outputContainer.innerHTML = ""; // Clear previous output

      // Format-based rendering
      if (format === "html") {
        outputContainer.innerHTML = data;
      } else if (format === "markdown") {
        outputContainer.innerHTML = marked.parse(data);
      } else if (format === "json") {
        let parsed;
        try {
          parsed = typeof data === "string" ? JSON.parse(data) : data;
        } catch (err) {
          parsed = { error: "Failed to parse JSON", raw: data };
        }
        outputContainer.innerHTML = renderJsonAsTable(parsed);
      } else {
        outputContainer.textContent = data;
      }

      document.getElementById("result").classList.remove("hidden");

    } catch (err) {
      alert("Failed to scrape: " + err.message);
      console.error(err);
    }
  });
</script> -->

</body>
</html>